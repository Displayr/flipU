on:
  push:
    branches: '**'

jobs:
  push:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/displayr/r-server-skinny-base:basic
      credentials:
        username: jrwishart
        password: ${{ secrets.JUSTIN_GITHUB_PAT }}
    steps:
      - name: Install stuff
        run: |
          apt-fast install -y git
        env:
          GITHUB_PAT: ${{ secrets.JUSTIN_GITHUB_PAT }}
      - name: Pull code
        uses: actions/checkout@v2
      - name: Check directory #DELETE ME!!
        run: ls
      - name: Run R CMD check and test
        env:
          _R_CHECK_CRAN_INCOMING_: false
        run: |
          rcmdcheck::rcmdcheck(args = c("--as-cran", "--no-manual", "--no-build-vignettes"), build_args = c("--no-build-vignettes", "--no-resave-data"))
        shell: Rscript {0}
